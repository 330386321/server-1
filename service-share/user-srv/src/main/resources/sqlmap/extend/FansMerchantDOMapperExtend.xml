<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="com.lawu.eshop.user.srv.mapper.extend.FansMerchantDOMapperExtend">
    <resultMap id="BaseResultMap" type="com.lawu.eshop.user.srv.domain.extend.FansMerchantDOView">
        <result column="memberId" property="memberId" jdbcType="BIGINT"/>
        <result column="num" property="num" jdbcType="VARCHAR"/>
        <result column="account" property="account" jdbcType="VARCHAR"/>
        <result column="region_path" property="regionPath" jdbcType="VARCHAR"/>
        <result column="sex" property="sex" jdbcType="TINYINT"/>
        <result column="age" property="age" jdbcType="INTEGER"/>
    </resultMap>

    <select resultMap="BaseResultMap" parameterType="com.lawu.eshop.user.param.InviteInviteFansRealParam"
            id="listInviteFans">
        select id as memberId,num,account from member where region_path = #{regionPath,jdbcType=VARCHAR}
        <if test="startAge != null">
            and TIMESTAMPDIFF(YEAR,birthday,CURRENT_DATE) &gt;= #{startAge,jdbcType=INTEGER}
        </if>
        <if test="endAge != null">
            and TIMESTAMPDIFF(YEAR,birthday,CURRENT_DATE) &lt;= #{endAge,jdbcType=INTEGER}
        </if>
        <if test="sex != null and sex != 1">
            and sex = {sex,jdbcType=TINYINT};
        </if>
        and id not in(select member_id from fans_merchant where merchant_id = #{merchantId,jdbcType=BIGINT})
    </select>

    <select resultMap="BaseResultMap" parameterType="com.lawu.eshop.user.param.ListFansRealParam" id="listFans">
        select mem.account,mem.region_path,mem.sex,TIMESTAMPDIFF(YEAR,mem.birthday,CURRENT_DATE) as age
        from fans_merchant fm inner join member mem on fm.member_id = mem.id
        where fm.merchant_id = #{merchantId,,jdbcType=BIGINT}
        <if test="regionPath != null">
            and mem.region_path = #{regionPath,jdbcType=VARCHAR}
        </if>
        <if test="startAge != null">
            and TIMESTAMPDIFF(YEAR,mem.birthday,CURRENT_DATE) &gt;= #{startAge,jdbcType=INTEGER}
        </if>
        <if test="endAge != null">
            and TIMESTAMPDIFF(YEAR,mem.birthday,CURRENT_DATE) &lt;= #{endAge,jdbcType=INTEGER}
        </if>
        <if test="sex != null and sex != 1">
            and mem.sex = {sex,jdbcType=TINYINT};
        </if>
        and id not in(select member_id from fans_merchant where merchant_id = #{merchantId,jdbcType=BIGINT})
    </select>
</mapper>