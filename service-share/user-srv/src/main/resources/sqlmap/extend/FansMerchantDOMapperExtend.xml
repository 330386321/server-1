<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="com.lawu.eshop.user.srv.mapper.extend.FansMerchantDOMapperExtend">
    <resultMap id="BaseResultMap" type="com.lawu.eshop.user.srv.domain.extend.FansMerchantDOView">
        <result column="memberId" property="memberId" jdbcType="BIGINT"/>
        <result column="num" property="num" jdbcType="VARCHAR"/>
        <result column="account" property="account" jdbcType="VARCHAR"/>
        <result column="region_path" property="regionPath" jdbcType="VARCHAR"/>
        <result column="region_name" property="regionName" jdbcType="VARCHAR"/>
        <result column="nickname" property="nickname" jdbcType="VARCHAR"/>
        <result column="headimg" property="headimg" jdbcType="VARCHAR"/>
        <result column="level" property="level" jdbcType="INTEGER"/>
        <result column="gmt_create" property="gmtCreate" jdbcType="TIMESTAMP"/>
    </resultMap>

    <select resultMap="BaseResultMap" parameterType="com.lawu.eshop.user.param.InviteFansParam" id="listInviteFans">
        select id as memberId,num,account from member where region_path = #{regionPath,jdbcType=VARCHAR}
        and id not in(select member_id from fans_merchant where merchant_id = #{merchantId,jdbcType=BIGINT})
    </select>

    <select resultMap="BaseResultMap" parameterType="com.lawu.eshop.user.param.ListFansRealParam" id="listFans">
        select mem.account,mem.region_path,mem.region_name,mem.nickname,mem.headimg,mem.level,fm.gmt_create
        from fans_merchant fm inner join member mem on fm.member_id = mem.id
        where fm.merchant_id = #{merchantId,,jdbcType=BIGINT}
        <if test="regionPath != null">
            and mem.region_path like CONCAT(#{regionPath,jdbcType=VARCHAR},'%')
        </if>
        order by fm.id desc
        limit #{offset,,jdbcType=INTEGER},#{pageSize,,jdbcType=INTEGER}
    </select>

    <select resultType="java.lang.Integer" parameterType="com.lawu.eshop.user.param.ListFansRealParam" id="countFans">
        select count(1)
        from fans_merchant fm inner join member mem on fm.member_id = mem.id
        where fm.merchant_id = #{merchantId,,jdbcType=BIGINT}
        <if test="regionPath != null">
            and mem.region_path like CONCAT(#{regionPath,jdbcType=VARCHAR},'%')
        </if>
    </select>
</mapper>