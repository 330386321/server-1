<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.lawu.eshop.order.srv.mapper.extend.ShoppingOrderExtendDOMapper">
	
	<resultMap id="ShoppingOrderItemResultMap" type="com.lawu.eshop.order.srv.domain.ShoppingOrderItemDO">
		<id column="item_id" jdbcType="BIGINT" property="id" />
		<result column="shopping_order_id" jdbcType="BIGINT" property="shoppingOrderId" />
		<result column="product_id" jdbcType="BIGINT" property="productId" />
		<result column="product_name" jdbcType="VARCHAR" property="productName" />
		<result column="product_model_id" jdbcType="BIGINT" property="productModelId" />
		<result column="product_model_name" jdbcType="VARCHAR" property="productModelName" />
		<result column="product_feature_image" jdbcType="VARCHAR" property="productFeatureImage" />
		<result column="regular_price" jdbcType="DECIMAL" property="regularPrice" />
		<result column="sales_price" jdbcType="DECIMAL" property="salesPrice" />
		<result column="is_allow_refund" jdbcType="BIT" property="isAllowRefund" />
		<result column="is_evaluation" jdbcType="BIT" property="isEvaluation" />
		<result column="quantity" jdbcType="INTEGER" property="quantity" />
		<result column="item_order_status" jdbcType="TINYINT" property="orderStatus" />
		<result column="refund_status" jdbcType="TINYINT" property="refundStatus" />
		<result column="send_time" jdbcType="INTEGER" property="sendTime" />
		<result column="item_gmt_create" jdbcType="TIMESTAMP" property="gmtCreate" />
		<result column="item_gmt_modified" jdbcType="TIMESTAMP" property="gmtModified" />
	</resultMap>
	
	<resultMap id="ShoppingOrderBaseResultMap" type="com.lawu.eshop.order.srv.domain.ShoppingOrderDO">
	  <id column="id" jdbcType="BIGINT" property="id" />
	  <result column="member_id" jdbcType="BIGINT" property="memberId" />
	  <result column="member_num" jdbcType="VARCHAR" property="memberNum" />
	  <result column="merchant_id" jdbcType="BIGINT" property="merchantId" />
	  <result column="merchant_num" jdbcType="VARCHAR" property="merchantNum" />
	  <result column="merchant_name" jdbcType="VARCHAR" property="merchantName" />
	  <result column="consignee_name" jdbcType="VARCHAR" property="consigneeName" />
	  <result column="consignee_address" jdbcType="VARCHAR" property="consigneeAddress" />
	  <result column="consignee_mobile" jdbcType="VARCHAR" property="consigneeMobile" />
	  <result column="remark" jdbcType="VARCHAR" property="remark" />
	  <result column="message" jdbcType="VARCHAR" property="message" />
	  <result column="freight_price" jdbcType="DECIMAL" property="freightPrice" />
	  <result column="commodity_total_price" jdbcType="DECIMAL" property="commodityTotalPrice" />
	  <result column="order_total_price" jdbcType="DECIMAL" property="orderTotalPrice" />
	  <result column="actual_amount" jdbcType="DECIMAL" property="actualAmount" />
      <result column="commission_status" jdbcType="TINYINT" property="commissionStatus" />
	  <result column="order_status" jdbcType="TINYINT" property="orderStatus" />
	  <result column="status" jdbcType="TINYINT" property="status" />
	  <result column="send_time" jdbcType="INTEGER" property="sendTime" />
	  <result column="is_no_reason_return" jdbcType="BIT" property="isNoReasonReturn" />
	  <result column="is_automatic_receipt" jdbcType="BIT" property="isAutomaticReceipt" />
	  <result column="shopping_cart_ids_str" jdbcType="VARCHAR" property="shoppingCartIdsStr" />
	  <result column="order_num" jdbcType="VARCHAR" property="orderNum" />
	  <result column="payment_method" jdbcType="TINYINT" property="paymentMethod" />
	  <result column="third_number" jdbcType="VARCHAR" property="thirdNumber" />
	  <result column="waybill_num" jdbcType="VARCHAR" property="waybillNum" />
	  <result column="express_company_id" jdbcType="INTEGER" property="expressCompanyId" />
	  <result column="express_company_code" jdbcType="VARCHAR" property="expressCompanyCode" />
	  <result column="express_company_name" jdbcType="VARCHAR" property="expressCompanyName" />
	  <result column="gmt_commission" jdbcType="TIMESTAMP" property="gmtCommission" />
	  <result column="gmt_payment" jdbcType="TIMESTAMP" property="gmtPayment" />
	  <result column="gmt_transport" jdbcType="TIMESTAMP" property="gmtTransport" />
	  <result column="gmt_transaction" jdbcType="TIMESTAMP" property="gmtTransaction" />
	  <result column="gmt_create" jdbcType="TIMESTAMP" property="gmtCreate" />
	  <result column="gmt_modified" jdbcType="TIMESTAMP" property="gmtModified" />
	</resultMap>
	
	<resultMap id="ShoppingOrderExtendResultMap" type="com.lawu.eshop.order.srv.domain.extend.ShoppingOrderExtendDO">
		<id column="id" jdbcType="BIGINT" property="id" />
		<result column="member_id" jdbcType="BIGINT" property="memberId" />
		<result column="member_num" jdbcType="VARCHAR" property="memberNum" />
		<result column="merchant_id" jdbcType="BIGINT" property="merchantId" />
		<result column="merchant_num" jdbcType="VARCHAR" property="merchantNum" />
		<result column="merchant_name" jdbcType="VARCHAR" property="merchantName" />
		<result column="consignee_name" jdbcType="VARCHAR" property="consigneeName" />
		<result column="consignee_address" jdbcType="VARCHAR" property="consigneeAddress" />
		<result column="consignee_mobile" jdbcType="VARCHAR" property="consigneeMobile" />
		<result column="remark" jdbcType="VARCHAR" property="remark" />
		<result column="message" jdbcType="VARCHAR" property="message" />
		<result column="freight_price" jdbcType="DECIMAL" property="freightPrice" />
		<result column="commodity_total_price" jdbcType="DECIMAL" property="commodityTotalPrice" />
		<result column="order_total_price" jdbcType="DECIMAL" property="orderTotalPrice" />
		<result column="actual_amount" jdbcType="DECIMAL" property="actualAmount" />
    	<result column="commission_status" jdbcType="TINYINT" property="commissionStatus" />
		<result column="order_status" jdbcType="TINYINT" property="orderStatus" />
		<result column="status" jdbcType="TINYINT" property="status" />
		<result column="send_time" jdbcType="INTEGER" property="sendTime" />
		<result column="is_no_reason_return" jdbcType="BIT" property="isNoReasonReturn" />
		<result column="is_automatic_receipt" jdbcType="BIT" property="isAutomaticReceipt" />
		<result column="shopping_cart_ids_str" jdbcType="VARCHAR" property="shoppingCartIdsStr" />
		<result column="order_num" jdbcType="VARCHAR" property="orderNum" />
		<result column="payment_method" jdbcType="TINYINT" property="paymentMethod" />
		<result column="third_number" jdbcType="VARCHAR" property="thirdNumber" />
	    <result column="is_needs_logistics" jdbcType="BIT" property="isNeedsLogistics" />
		<result column="waybill_num" jdbcType="VARCHAR" property="waybillNum" />
		<result column="express_company_id" jdbcType="INTEGER" property="expressCompanyId" />
		<result column="express_company_code" jdbcType="VARCHAR" property="expressCompanyCode" />
		<result column="express_company_name" jdbcType="VARCHAR" property="expressCompanyName" />
		<result column="gmt_commission" jdbcType="TIMESTAMP" property="gmtCommission" />
		<result column="gmt_payment" jdbcType="TIMESTAMP" property="gmtPayment" />
		<result column="gmt_transport" jdbcType="TIMESTAMP" property="gmtTransport" />
		<result column="gmt_transaction" jdbcType="TIMESTAMP" property="gmtTransaction" />
		<result column="gmt_create" jdbcType="TIMESTAMP" property="gmtCreate" />
		<result column="gmt_modified" jdbcType="TIMESTAMP" property="gmtModified" />
		<!-- 级联查询 -->
		<collection property="items" column="item_id" javaType="list" ofType="com.lawu.eshop.order.srv.domain.ShoppingOrderItemDO" resultMap="ShoppingOrderItemResultMap"/>  
	</resultMap>
	
	<resultMap id="ReportResultMap" type="com.lawu.eshop.order.srv.domain.extend.ReportRiseRateView">
		<result column="keyTxt" property="keyTxt" jdbcType="VARCHAR" />
		<result column="num" property="num" jdbcType="VARCHAR" />
	</resultMap>
	
	<sql id="Example_Where_Clause">
		<where>
			<foreach collection="oredCriteria" item="criteria" separator="or">
				<if test="criteria.valid">
					<trim prefix="(" prefixOverrides="and" suffix=")">
						<foreach collection="criteria.criteria" item="criterion">
							<choose>
								<when test="criterion.noValue">
									and ${criterion.condition}
								</when>
								<when test="criterion.singleValue">
									and ${criterion.condition} #{criterion.value}
								</when>
								<when test="criterion.betweenValue">
									and ${criterion.condition} #{criterion.value}
									and
									#{criterion.secondValue}
								</when>
								<when test="criterion.listValue">
									and ${criterion.condition}
									<foreach close=")" collection="criterion.value" item="listItem" open="(" separator=",">
										#{listItem}
									</foreach>
								</when>
							</choose>
						</foreach>
					</trim>
				</if>
			</foreach>
		</where>
	</sql>
	
	<sql id="ShoppingOrder_Column_List">
		so.id, so.member_id, so.member_num, so.merchant_id, so.merchant_num, so.merchant_name,
		so.consignee_name,
		so.consignee_address,
		so.consignee_mobile, so.remark,
		so.message, so.freight_price, so.commodity_total_price,
		so.order_total_price, so.actual_amount, so.commission_status,
		so.order_status, so.status, so.send_time,
		so.is_no_reason_return, so.is_automatic_receipt, so.shopping_cart_ids_str,
		so.order_num, so.payment_method, so.third_number, so.is_needs_logistics, so.waybill_num, so.express_company_id, so.express_company_code,
		so.express_company_name, so.gmt_commission,
		so.gmt_payment, so.gmt_transport,
		so.gmt_transaction, so.gmt_create, so.gmt_modified
	</sql>

	<sql id="ShoppingOrderItem_Column_List">
		soi.id as item_id, soi.shopping_order_id, soi.product_id,
		soi.product_name,
		soi.product_model_id,
		soi.product_model_name,
		soi.product_feature_image, soi.regular_price, soi.sales_price,
		soi.quantity, soi.is_allow_refund, soi.is_evaluation, soi.order_status as item_order_status, soi.refund_status,
		soi.gmt_create as item_gmt_create, soi.gmt_modified as item_gmt_modified
	</sql>
	
	<select id="selectByExampleWithRowbounds" parameterType="com.lawu.eshop.order.srv.domain.extend.ShoppingOrderExtendDOExample" resultMap="ShoppingOrderExtendResultMap">
		select
		<if test="distinct">
			distinct
		</if>
		<include refid="ShoppingOrder_Column_List" />
		<if test="isIncludeViewShoppingOrderItem">
		,
		<include refid="ShoppingOrderItem_Column_List" />
		</if>
		from shopping_order so
		<if test="isIncludeShoppingOrderItem">
			left join shopping_order_item soi on so.id = soi.shopping_order_id
		</if>
		<if test="_parameter != null">
			<include refid="Example_Where_Clause" />
		</if>
		<if test="orderByClause != null">
			order by ${orderByClause}
		</if>
	</select>

	<select id="countByExample" parameterType="com.lawu.eshop.order.srv.domain.extend.ShoppingOrderExtendDOExample" resultType="java.lang.Long">
		select count(<if test="distinct">distinct</if> so.id)
		from shopping_order so
		<if test="isIncludeShoppingOrderItem">
			left join shopping_order_item soi on so.id = soi.shopping_order_id
		</if>
		<if test="_parameter != null">
			<include refid="Example_Where_Clause" />
		</if>
	</select>
	
	<select id="selectByPrimaryKey" parameterType="java.lang.Long" resultMap="ShoppingOrderExtendResultMap">
	  select 
	  <include refid="ShoppingOrder_Column_List" />
	  ,
	  <include refid="ShoppingOrderItem_Column_List" />
	  from shopping_order so
	  left join shopping_order_item soi on so.id = soi.shopping_order_id
	  where so.id = #{id,jdbcType=BIGINT}
	</select>
	
	<select id="selectByExample" parameterType="com.lawu.eshop.order.srv.domain.extend.ShoppingOrderExtendDOExample" resultMap="ShoppingOrderExtendResultMap">
		select
		<if test="distinct">
			distinct
		</if>
		<include refid="ShoppingOrder_Column_List" />
		<if test="isIncludeViewShoppingOrderItem">
		,
		<include refid="ShoppingOrderItem_Column_List" />
		</if>
		from shopping_order so
		<if test="isIncludeShoppingOrderItem">
			left join shopping_order_item soi on so.id = soi.shopping_order_id
		</if>
		<if test="_parameter != null">
			<include refid="Example_Where_Clause" />
		</if>
		<if test="orderByClause != null">
			order by ${orderByClause}
		</if>
	</select>
	
	<update id="updateByPrimaryKeySelective" parameterType="com.lawu.eshop.order.srv.domain.extend.ShoppingOrderExtendDO">
	    update shopping_order so
	    <set>
	      <if test="memberId != null">
	        so.member_id = #{memberId,jdbcType=BIGINT},
	      </if>
	      <if test="memberNum != null">
	        so.member_num = #{memberNum,jdbcType=VARCHAR},
	      </if>
	      <if test="merchantId != null">
	        so.merchant_id = #{merchantId,jdbcType=BIGINT},
	      </if>
	      <if test="merchantNum != null">
	        so.merchant_num = #{merchantNum,jdbcType=VARCHAR},
	      </if>
	      <if test="merchantName != null">
	        so.merchant_name = #{merchantName,jdbcType=VARCHAR},
	      </if>
	      <if test="consigneeName != null">
	        so.consignee_name = #{consigneeName,jdbcType=VARCHAR},
	      </if>
	      <if test="consigneeAddress != null">
	        so.consignee_address = #{consigneeAddress,jdbcType=VARCHAR},
	      </if>
	      <if test="consigneeMobile != null">
	        so.consignee_mobile = #{consigneeMobile,jdbcType=VARCHAR},
	      </if>
	      <if test="remark != null">
	        so.remark = #{remark,jdbcType=VARCHAR},
	      </if>
	      <if test="message != null">
	        so.message = #{message,jdbcType=VARCHAR},
	      </if>
	      <if test="freightPrice != null">
	        so.freight_price = #{freightPrice,jdbcType=DECIMAL},
	      </if>
	      <if test="commodityTotalPrice != null">
	        so.commodity_total_price = #{commodityTotalPrice,jdbcType=DECIMAL},
	      </if>
	      <if test="orderTotalPrice != null">
	        so.order_total_price = #{orderTotalPrice,jdbcType=DECIMAL},
	      </if>
	      <if test="actualAmount != null">
	        so.actual_amount = #{actualAmount,jdbcType=DECIMAL},
	      </if>
	      <if test="commissionStatus != null">
	        so.commission_status = #{commissionStatus,jdbcType=TINYINT},
	      </if>
	      <if test="orderStatus != null">
	        so.order_status = #{orderStatus,jdbcType=TINYINT},
	      </if>
	      <if test="status != null">
	        so.status = #{status,jdbcType=TINYINT},
	      </if>
	      <if test="sendTime != null">
	        so.send_time = #{sendTime,jdbcType=INTEGER},
	      </if>
	      <if test="isNoReasonReturn != null">
	        so.is_no_reason_return = #{isNoReasonReturn,jdbcType=BIT},
	      </if>
	      <if test="isAutomaticReceipt != null">
	        so.is_automatic_receipt = #{isAutomaticReceipt,jdbcType=BIT},
	      </if>
	      <if test="shoppingCartIdsStr != null">
	        so.shopping_cart_ids_str = #{shoppingCartIdsStr,jdbcType=VARCHAR},
	      </if>
	      <if test="orderNum != null">
	        so.order_num = #{orderNum,jdbcType=VARCHAR},
	      </if>
	      <if test="paymentMethod != null">
	        so.payment_method = #{paymentMethod,jdbcType=TINYINT},
	      </if>
	      <if test="thirdNumber != null">
	        so.third_number = #{thirdNumber,jdbcType=VARCHAR},
	      </if>
	      <if test="waybillNum != null">
	        so.waybill_num = #{waybillNum,jdbcType=VARCHAR},
	      </if>
	      <if test="expressCompanyId != null">
	        so.express_company_id = #{expressCompanyId,jdbcType=INTEGER},
	      </if>
	      <if test="expressCompanyCode != null">
	        so.express_company_code = #{expressCompanyCode,jdbcType=VARCHAR},
	      </if>
	      <if test="expressCompanyName != null">
	        so.express_company_name = #{expressCompanyName,jdbcType=VARCHAR},
	      </if>
	      <if test="gmtCommission != null">
	        so.gmt_commission = #{gmtCommission,jdbcType=TIMESTAMP},
	      </if>
	      <if test="gmtPayment != null">
	        so.gmt_payment = #{gmtPayment,jdbcType=TIMESTAMP},
	      </if>
	      <if test="gmtTransport != null">
	        so.gmt_transport = #{gmtTransport,jdbcType=TIMESTAMP},
	      </if>
	      <if test="gmtTransaction != null">
	        so.gmt_transaction = #{gmtTransaction,jdbcType=TIMESTAMP},
	      </if>
	      <if test="gmtCreate != null">
	        so.gmt_create = #{gmtCreate,jdbcType=TIMESTAMP},
	      </if>
	      <if test="gmtModified != null">
	        so.gmt_modified = #{gmtModified,jdbcType=TIMESTAMP},
	      </if>
	      
	      <!-- Extend -->
    	  <if test="actualAmountSubtraction != null">
	        so.actual_amount = so.actual_amount - #{actualAmountSubtraction,jdbcType=DECIMAL},
	      </if>
	    </set>
	    where id = #{id,jdbcType=BIGINT}
	  </update>
	  
	  <!-- Report -->
	  <select id="selectByTransactionData" parameterType="com.lawu.eshop.order.srv.domain.extend.ShoppingOrderExtendDOExample" resultMap="ReportResultMap">
	  	SELECT DATE_FORMAT(so.gmt_create, "%m") AS keyTxt, sum(so.actual_amount) AS num
	  	FROM shopping_order so
	  	<if test="isIncludeShoppingOrderItem">
			left join shopping_order_item soi on so.id = soi.shopping_order_id
		</if>
		<if test="_parameter != null">
			<include refid="Example_Where_Clause" />
		</if>
		GROUP BY keyTxt
	  </select>
	  
	  <select id="selectByTransactionTotalAmount" parameterType="com.lawu.eshop.order.srv.domain.extend.ShoppingOrderExtendDOExample" resultType="java.math.BigDecimal">
	  	SELECT sum(so.actual_amount) AS num
	  	FROM shopping_order so
	  	<if test="isIncludeShoppingOrderItem">
			left join shopping_order_item soi on so.id = soi.shopping_order_id
		</if>
		<if test="_parameter != null">
			<include refid="Example_Where_Clause" />
		</if>
	  </select>
</mapper>